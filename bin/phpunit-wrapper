#!/usr/bin/env php
<?php
echo "Worker starting\n";

// git working copy
if (file_exists(__DIR__ . '/../vendor/autoload.php')) {
    require_once __DIR__ . '/../vendor/autoload.php';
}
// Composer installation
if (file_exists(__DIR__ . '/../../../autoload.php')) {
    require_once __DIR__ . '/../../../autoload.php';
}

// $commands = fopen('php://stdin', 'r');

$commands = [
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --filter testGetCommandStringIncludesOptions --log-junit /tmp/PT_jxcTll  /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/ExecutableTestTest.php',
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --filter testConstructor --log-junit /tmp/PT_5giutH  /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/ExecutableTestTest.php',
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --filter testGetCommandStringDoesNotIncludeEnvironmentVariablesToKeepCompatibilityWithWindows --log-junit /tmp/PT_xqvneZ  /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/ExecutableTestTest.php',
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --filter testGetCommandStringIncludesTheClassName --log-junit /tmp/PT_1KfX6C  /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/ExecutableTestTest.php',
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --filter testHandleEnvironmentVariablesAssignsToken --log-junit /tmp/PT_Z7eDZg  /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/ExecutableTestTest.php',
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --filter testGetTokenReturnsValidToken --log-junit /tmp/PT_o1Vl0U  /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/ExecutableTestTest.php',
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --filter testGetTempFileShouldCreateTempFile --log-junit /tmp/PT_7GBb1y /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/ExecutableTestTest.php' ,
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --filter testGetTempFileShouldReturnSameFileIfAlreadyCalled --log-junit /tmp/PT_M3u71c  /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/ExecutableTestTest.php'
];

$commands = [
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --log-junit /tmp/PT_jxcTll  /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/ExecutableTestTest.php',
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --log-junit /tmp/PT_5giutH  /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/OptionsTest.php',
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --log-junit /tmp/PT_xqvneZ  /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/ConfigurationTest.php',
'/home/dbaltas/projects/paratest/vendor/bin/phpunit --configuration /home/dbaltas/projects/paratest/phpunit.xml.dist --log-junit /tmp/PT_Z7eDZg  /home/dbaltas/projects/paratest/test/ParaTest/Runners/PHPUnit/RunnerTest.php'
];
while (true) {
    $command = array_pop($commands);
    if (empty($command)) exit;
    echo "Executing: $command\n";
    $_SERVER['argv'] = explode(' ', $command);

    $lastExitCode = PHPUnit_TextUI_Command::main(false);
    echo $lastExitCode."FINISHED\n";
}
